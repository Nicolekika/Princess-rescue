<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Princess Rescue ‚Äî Single File (18+)</title>
  <style>
    :root{--bg:#fff9fc;--ink:#3a2f35;--line:#f2d9e8;--panel:#ffffffcc;--pill:#f7e7f1;--cta:#f9dff0;--sh:0 10px 30px rgba(125,89,110,.12)}
    *{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,var(--bg),#ffeef7);font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink)}
    header{position:sticky;top:0;background:rgba(255,255,255,.65);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);padding:10px 12px;display:flex;justify-content:space-between;z-index:5}
    .pill{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:8px 12px;box-shadow:var(--sh);cursor:pointer}
    .wrap{max-width:1000px;margin:0 auto;padding:16px}
    .hud{position:absolute;top:16px;left:16px;display:flex;gap:10px;background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:6px 10px}
    canvas{width:100%;height:auto;border:1px solid var(--line);border-radius:14px;box-shadow:var(--sh);background:#fff0f6}
    dialog::backdrop{background:rgba(0,0,0,.35)} dialog{border:none;border-radius:16px;padding:0}
    dialog .sheet{background:#fff;padding:16px;min-width:min(520px,92vw);border-radius:16px}
  </style>
</head>
<body>
  <header>
    <div class="brand">‚ô° Princess Rescue</div>
    <nav>
      <button id="btn-how" class="pill">Hur spelar man?</button>
      <button id="btn-shop" class="pill">Butik</button>
    </nav>
  </header>

  <main class="wrap">
    <div style="position:relative">
      <canvas id="game" width="960" height="540"></canvas>
      <div class="hud">
        <div>‚ù§ <span id="lives">3</span></div>
        <div>‚òÖ <span id="hearts">0</span>/5</div>
        <div>‚è± <span id="time">0.0s</span></div>
        <button id="btn-audio" class="pill" title="Ljud p√•/av">üîä</button>
      </div>
    </div>
  </main>

  <!-- √Öldersgrind -->
  <dialog id="age"><form method="dialog" class="sheet">
    <h2>Bekr√§fta √•lder</h2>
    <p>Detta √§r ett vuxet utrymme (icke-explicit spel). Du m√•ste vara 18+.</p>
    <label><input id="ok18" type="checkbox" required> Jag √§r 18+</label>
    <menu><button value="cancel">Avbryt</button><button id="go" value="ok">Forts√§tt</button></menu>
  </form></dialog>

  <!-- Hj√§lp -->
  <dialog id="how"><form method="dialog" class="sheet">
    <h3>Hur spelar man</h3>
    <ul><li>A/D eller ‚Üê/‚Üí = g√•</li><li>W/‚Üë/Space = hoppa</li><li>Undvik spikar</li></ul>
    <menu><button>OK</button></menu>
  </form></dialog>

  <script>
  (() => {
    // ===== basic selectors =====
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    const livesEl = document.getElementById('lives');
    const heartsEl = document.getElementById('hearts');
    const timeEl  = document.getElementById('time');
    const dlgAge  = document.getElementById('age');
    const ok18    = document.getElementById('ok18');
    const goBtn   = document.getElementById('go');
    const btnHow  = document.getElementById('btn-how');

    // ===== age gate =====
    if (localStorage.getItem('age_ok')!=='yes') {
      setTimeout(()=>dlgAge.showModal(), 10);
    }
    goBtn?.addEventListener('click', e => {
      if (!ok18.checked) { e.preventDefault(); alert('Bekr√§fta 18+.'); }
      else localStorage.setItem('age_ok','yes');
    });
    btnHow?.addEventListener('click', ()=> document.getElementById('how').showModal());

    // ===== minimal game loop to verify draw =====
    let t0 = performance.now();
    let x = 40, y = 60, vx = 1.8, vy = 1.2; // r√∂rlig prick s√• vi SER att loopen k√∂r
    let won = false;

    function draw(ts){
      // bakgrund
      ctx.fillStyle = '#ffe7f2';
      ctx.fillRect(0,0,cvs.width,cvs.height);

      // moln
      ctx.globalAlpha = 0.25;
      ctx.fillStyle = '#fff';
      for (let i=0;i<6;i++){
        const cx = (i*180 + (ts/20)%180) % cvs.width;
        const cy = 60 + ((i%2)*30);
        ctx.beginPath(); ctx.arc(cx,cy,40,0,Math.PI*2);
        ctx.arc(cx+40,cy+10,28,0,Math.PI*2);
        ctx.arc(cx+80,cy,36,0,Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      // r√∂rlig prick (debug)
      ctx.fillStyle = '#ff4aa8';
      ctx.fillRect(x, y, 18, 18);

      // HUD-tid
      timeEl.textContent = ((ts - t0)/1000).toFixed(1) + 's';
    }

    function update(){
      // studs i kanterna
      x += vx; y += vy;
      if (x<0 || x>cvs.width-18) vx *= -1;
      if (y<0 || y>cvs.height-18) vy *= -1;
    }

    function loop(ts){
      update();
      draw(ts||performance.now());
      requestAnimationFrame(loop);
    }

    // start direkt
    requestAnimationFrame(loop);

    // ===== simple audio toggle so knappen g√∂r n√•got =====
    let ac, timer, musicOn = true;
    function initAudio(){ if(ac) return; ac=new (window.AudioContext||window.webkitAudioContext)(); startMusic(); }
    function beep(f=440,d=0.12,type='triangle',g=0.15){ if(!ac) return; const o=ac.createOscillator(), gg=ac.createGain(); o.type=type; o.frequency.value=f; gg.gain.value=g; o.connect(gg); gg.connect(ac.destination); o.start(); gg.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+d); o.stop(ac.currentTime+d+0.02); }
    function startMusic(){ if(!ac||!musicOn) return; stopMusic(); let i=0, seq=[262,330,392,523,392,330,294,330]; timer=setInterval(()=>{beep(seq[i++%seq.length],0.15);},350); }
    function stopMusic(){ if(timer) clearInterval(timer); timer=null; }
    document.getElementById('btn-audio').addEventListener('click', ()=>{
      initAudio(); musicOn=!musicOn; event.target.textContent = musicOn?'üîä':'üîà'; musicOn?startMusic():stopMusic();
    });
    document.body.addEventListener('keydown', ()=>initAudio(), {once:true});
  })();
  </script>
</body>
</html>
